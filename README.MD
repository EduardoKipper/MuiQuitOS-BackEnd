# ü¶ü MuiQuitOS-BackEnd

Backend MVP em Julia para registro e controle de focos do mosquito Aedes Aegypti.

## ‚öôÔ∏è Setup do Sistema

1. **Pr√©-requisitos:**
   - Julia instalado ([üîó](https://julialang.org/downloads/))

2. **Instale as depend√™ncias do projeto:**
   Abra o terminal na pasta do projeto (MuiQuitOS-BackEnd) e execute em sequ√™ncia:
   ```sh
   julia
   ] activate .
   dev ./MuiQuitOSBackEnd
   ```
   (O `]` entra no modo de pacote do Julia REPL. Use Backspace para voltar ao prompt `julia>`.)

3. **Instale as depend√™ncias do pacote:**
   Feche o terminal anterior e abra um novo.
   No novo terminal, entre na pasta do pacot~e:
   ```sh
   cd MuiQuitOSBackEnd
   ```
   E execute em sequ√™ncia:
   ```sh
   julia
   ] activate .
   add CSV DataFrames JSON3 HTTP Sockets Statistics StatsBase Plots Gadfly Dates
   ```
   > **Observa√ß√£o:**
   > O pacote `Dates` agora √© utilizado para manipula√ß√£o de datas e gera√ß√£o dos gr√°ficos temporais.

4. **Gera√ß√£o autom√°tica de gr√°ficos:**
   Ao executar o backend, tr√™s gr√°ficos s√£o gerados automaticamente na pasta `cache/`:
   - `registers_by_neighbourhood_pie.png`: Registros por bairro (gr√°fico de pizza)
   - `registers_by_time_of_day_line.png`: Registros por hora do dia (gr√°fico de linha)
   - `registers_by_month_line.png`: Registros por m√™s (gr√°fico de linha)

   Durante a gera√ß√£o dos gr√°ficos, mensagens informativas s√£o exibidas no console indicando o in√≠cio e o t√©rmino de cada gr√°fico.

5. **Execute o servidor:**
   Com as etapas anteriores feitas, toda vez que quiser executar o servidor basta executar, em ordem:
   ```sh
   julia
   ] activate .
   ```
   Pressione CTRL + C e execute:
   ```sh
   include("app.jl")
   ```

   ### O backend estar√° dispon√≠vel em: http://localhost:8080 üöÄ

## üìÅ Estrutura dos Arquivos
- `database/users.csv`: üë§ Usu√°rios do sistema
- `database/registers.csv`: ü¶ü Registros de focos de mosquito
- `MuiQuitOSBackEnd/src/models/`: üß© Defini√ß√µes de tipos (User, Register)
- `MuiQuitOSBackEnd/src/controllers/`: üß† L√≥gica das rotas
- `MuiQuitOSBackEnd/src/routes/`: üõ£Ô∏è Defini√ß√£o das rotas

## üì° Rotas da API

### üîë Login
- `POST /login`
  - **Body:** `{ "name": "string", "password": "string" }`
  - **Resposta:** 200 OK com dados do usu√°rio, 401 para credenciais inv√°lidas

### üë§ Usu√°rios
- `GET /users` ‚Äî Lista todos os usu√°rios
- `POST /users` ‚Äî Cria usu√°rio
  - **Body:** `{ "name": "string", "email": "string", "password": "string", "type": "string" }`
- `PUT /users` ‚Äî Atualiza usu√°rio
  - **Body:** igual ao POST
- `DELETE /users` ‚Äî Remove usu√°rio
  - **Body:** `{ "email": "string" }`

### ü¶ü Registros
- `GET /registers` ‚Äî Lista todos os registros
- `POST /registers` ‚Äî Cria registro
  - **Body:** `{ "user_id": "string", "cep": "string", "datetime": "string", "intensity": float, "evidence": "string", "latitude": float, "longitude": float, "city": "string", "state": "string", "neighbourhood": "string", "access_difficulty": int, "focus_size": int, "larvae": boolean }`
- `PUT /registers` ‚Äî Atualiza registro
  - **Body:** `{ "register_id": int, "user_id": "string", "cep": "string", "datetime": "string", "intensity": float, "evidence": "string", "latitude": float, "longitude": float, "city": "string", "state": "string", "neighbourhood": "string", "access_difficulty": int, "focus_size": int, "larvae": boolean }`
- `DELETE /registers` ‚Äî Remove registro
  - **Body:** `{ "register_id": int }`

## üìã Tabela de Endpoints da API

| M√©todo | Rota         | Descri√ß√£o                        | Body/Par√¢metros                                                                                                                                                                                           | Resposta Exemplo           |
|--------|--------------|-----------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|
| POST   | /login       | Login de usu√°rio                  | `{ "name": "string", "password": "string" }`                                                                                                                                                             | 200 OK (usu√°rio), 401      |
| GET    | /users       | Lista todos os usu√°rios           | -                                                                                                                                                                                                         | 200 OK (lista usu√°rios)    |
| POST   | /users       | Cria novo usu√°rio                 | `{ "name": "string", "email": "string", "password": "string", "type": "string" }`                                                                                                                            | 201 Created, 409 (duplicado) |
| PUT    | /users       | Atualiza usu√°rio                  | `{ "name": "string", "email": "string", "password": "string", "type": "string" }`                                                                                                                            | 200 OK                     |
| DELETE | /users       | Remove usu√°rio                    | `{ "email": "string" }`                                                                                                                                                                                  | 200 OK                     |
| GET    | /registers   | Lista todos os registros          | -                                                                                                                                                                                                         | 200 OK (lista registros)   |
| POST   | /registers   | Cria novo registro de mosquito    | `{ "user_id": "string", "cep": "string", "datetime": "string", "intensity": float, "evidence": "string", "latitude": float, "longitude": float, "city": "string", "state": "string", "neighbourhood": "string", "access_difficulty": int, "focus_size": int, "larvae": boolean }` | 201 Created, 400 (user_id inv√°lido) |
| PUT    | /registers   | Atualiza registro                 | `{ "register_id": int, "user_id": "string", "cep": "string", "datetime": "string", "intensity": float, "evidence": "string", "latitude": float, "longitude": float, "city": "string", "state": "string", "neighbourhood": "string", "access_difficulty": int, "focus_size": int, "larvae": boolean }` | 200 OK                     |
| DELETE | /registers   | Remove registro                   | `{ "register_id": int }`                                                                                                                                                                                 | 200 OK                     |

> **Observa√ß√£o:**
> - Todos os bodies devem ser enviados em JSON.
> - O campo `intensity` em `/registers` √© um n√∫mero de ponto flutuante.
> - O campo `user_id` deve ser um email v√°lido cadastrado em `/users`.

## ‚ÑπÔ∏è Observa√ß√µes
- Todos os dados s√£o persistidos em arquivos CSV üìÑ.
- O sistema n√£o implementa autentica√ß√£o avan√ßada (JWT, hashing de senha, etc).
- Ideal para MVP e testes r√°pidos ‚ö°.

---

## Comandos experimentais

- Criar usu√°rio: curl -X POST http://localhost:8080/users -H "Content-Type: application/json" -d "{\"name\": \"Nome Exemplo\", \"email\": \"exemplo@email.com\", \"password\": \"senha123\", \"type\": \"user\"}"
- Buscar usu√°rios: curl -X GET http://localhost:8080/users
- Fazer registro de mosquito: curl -X POST http://localhost:8080/registers -H "Content-Type: application/json" -d "{\"user_id\": \"exemplo@email.com\", \"cep\": \"88015-700\", \"datetime\": \"2025-07-01T10:00:00\", \"intensity\": 6.8, \"evidence\": null, \"latitude\": -27.5935, \"longitude\": -48.5585, \"city\": \"Florian√≥polis\", \"state\": \"SC\", \"neighbourhood\": \"Centro\", \"access_difficulty\": 7, \"focus_size\": 8, \"larvae\": true}"
- Buscar registros de mosquito: curl -X GET http://localhost:8080/registers
